"use strict";var e=require("@zxn2889/achieve-proxy");function t(e){if(e.type===Fragment)return void e.children.forEach((e=>t(e)));const n=e._el.parentNode;n&&n.removeChild(e._el)}function n(e,t,n){if(/^on/.test(e)){let o=(t._evi||(t._evi={}))[e];if(n)if(o)o.value=n;else{o=t._evi[e]=e=>{if(e.timeStamp<o.attachTime)return!1;Array.isArray(o.value)?o.value.forEach((e=>e)):"[object Object]"===Object.prototype.toString.call(o.value)?console.warn("事件值要为函数"):o.value(e)},o.value=n,o.attachTime=performance.now();const r=e.slice(2).toLowerCase();t.addEventListener(r,o)}else o&&t.removeEventListener(type,o)}"class"===e?t.className=n:!function(e,t){return("INPUT"!==t.tagName||"form"!==e)&&e in t}(e,t)?t.setAttribute(e,n):"boolean"==typeof t[e]&&""===n?t[e]=!0:t[e]=n}const o=Symbol(),r=Symbol(),l=Symbol();const c=function(c){const{createElement:s,setTextContent:i,insert:u}=c;function f(c,d,h,y){c&&c.type!==d.type&&(t(c),c=null);const m=d.type;if("string"==typeof m)c?function(e,t){const o=t._el=e._el,r=e.props,l=t.props;for(const e in l)Object.hasOwnProperty.call(l,e)&&l[e]!==r[e]&&n(e,o,l[e]);p(e,t,o)}(c,d):function(e,t,o){const r=e._el=s(e.type),l=e.children;if(e.props)for(const t in e.props)n(t,r,e.props[t]);if("string"==typeof l)i(r,l);else if(Array.isArray(l))for(let e=0;e<l.length;e++)f(null,l[e],r);u(r,t,o)}(d,h,y);else if(m===r)if(c){const e=d._el=c._el;d.children!==c.children&&(e.nodeValue=d.children)}else{const e=d._el=document.createTextNode(d.children);u(e,h)}else m===l?c?p(c,d,h):d.children.forEach((e=>f(null,e,h))):m===o||("object"==typeof m?c?function(e,t,n,o){const r=t._component=e._component,{props:l}=r;if(function(e,t){const n=Object.keys(e),o=Object.keys(t);if(n!==o)return!0;for(let o=0;o<n;o++){if(e[o]!==t[o])return!0}return!1}(e.props,t.props)){const[e]=a(t.type.props,t.type);Object.keys(l).forEach((t=>{t in e?l[t]=e[t]:delete l[t]}))}}(c,d):function(t,n,o){const r=t.type,{data:l,props:c,render:s,beforeCreate:i,created:u,beforeMounte:p,mounted:d,beforeUpdate:h,updated:y,setup:m}=r,[_,v]=a(c,t.props),b=t.children||{};i&&i.call();const g={state:e.reactive(l()),props:e.shallowReactive(_),subTree:null,isMounted:!1,mounted:[]};t._component=g;let E,A=s;if(m){const e={attr:v,emit:(e,...t)=>function(e,t,n){const o=`on${e[0].toUpperCase()}${e.slice(1)}`;o in n?n[o](t):console.warn(`当前事件未定义，请查看事件名称 ${o} 是否正确`)}(e,t,g.props),slots:b},t=m(shallowReadOnly(g.props),e);"function"==typeof t?A=t:E=t}const w=new Proxy(g,{get(e,t){const{state:n,props:o}=e;return n&&t in n?n[t]:o&&t in o?o[t]:E&&t in E?E[t]:"$slots"===t?b:(console.warn("当前组件不存在该属性"),null)},set(e,t,n){const{state:o,props:r}=e;if(o&&t in o)o[t]=n;else if(r&&t in r)r[t]=n;else{if(!E||!(t in E))return console.warn("当前组件不存在该属性"),!1;E[t]=n}}});u&&u.call(w),e.effect((()=>{const e=A.call(w);g.isMounted?(h&&h.call(w),f(g.subTree,e,n,o),y&&y.call(w)):(p&&p.call(w),f(null,e,n,o),g.isMounted=!0,g.mounted&&g.mounted.forEach((e=>e(w)))),g.subTree=e}))}(d,h,y):"function"==typeof m&&(c||function(t,n,o){const r=t.type,l=t.type.options,c={props:e.shallowReactive(l),subTree:null,isMounted:!1};t._component=c,e.effect((()=>{const e=r(l);c.isMounted?f(c.subTree,e,n,o):(f(null,e,n,o),c.isMounted=!0),c.subTree=e}))}(d,h,y)))}function a(e,t){const n={},o={};return Object.keys(t).forEach((r=>{r in e||"/^on/".text(r)?n[r]=t[r]:(console.warn("当前定义的属性在组件内没有定义，存放至 attr"),o[r]=t[r])})),[n,o]}function p(e,n,o){"string"==typeof n.children?(Array.isArray(e.children)&&e.children.forEach((e=>t(e))),i(o,n.children)):Array.isArray(n.children)?Array.isArray(e.children)?function(e,n,o){const r=e.children,l=n.children;let c=0,s=null,i=null;for(let e=0;e<l.length&&(s=r[e],i=l[e],i.key===s.key);e++)f(s,i,o),c++;const a=r.length,p=l.length,h=Math.max(a,p);let y=a-1,m=p-1;for(let e=h;e>=0&&(s=r[y],i=l[m],i.key===s.key);e--)f(s,i,o),y--,m--;if(y<c&&m>=c)for(let e=c;e<=m;e++)f(null,l[c],o,d(c,l));if(m<c&&y>=c)for(let e=c;e<=y;e++)t(r[e]);const _=new Array(m-c+1).fill(-1),v={};for(let e=c;e<=m;e++)v[l[e].key]=e;for(let e=c;e<=y;e++){s=r[e];const n=v[s.key];i=l[n],n>-1?(f(s,i,o),_[n-c]=e):t(s)}const b=function(e){const t=e.slice(),n=[0];let o,r,l,c,s;const i=e.length;for(o=0;o<i;o++){const i=e[o];if(0!==i){if(r=n[n.length-1],e[r]<i){t[o]=r,n.push(o);continue}for(l=0,c=n.length-1;l<c;)s=(l+c)/2|0,e[n[s]]<i?l=s+1:c=s;i<e[n[l]]&&(l>0&&(t[o]=n[l-1]),n[l]=o)}}l=n.length,c=n[l-1];for(;l-- >0;)n[l]=c,c=t[c];return n}(_),g=_.includes(-1);if(b.length<_.length||g){let e=b.length-1,t=_.length-1;for(;t>=0;t--)if(-1===_[t]){const e=t+c;f(null,l[e],o,d(e,l))}else if(t!==b[e]){let e=t+c;const n=l[e];u(n._el,o,d(e,l))}else e--}}(e,n,o):(i(el,""),n.children.forEach((e=>f(null,e,o)))):Array.isArray(e.children)?e.children.forEach((e=>t(e))):i(o,null)}function d(e,t){const n=t[e+1];return n?n._el:null}return{render:function(e,n){e?f(n._o_vnode,e,n):n._o_vnode&&t(n._o_vnode),n._o_vnode=e},patch:f}}({createElement:function(e){return document.createElement(e)},setTextContent:function(e,t){e.textContent=t},insert:function(e,t,n=null){t.insertBefore(e,n)}});function s(e){return{type:"div",children:`我是小黑，我今年 ${e.count} 岁了`}}s.options={count:1};const i={type:s};c.render(i,document.getElementById("app"));
