"use strict";var e=require("@zxn2889/achieve-proxy");let t=null;function n(e){t=e}function o(){return t}function r(e){if(e.type===Fragment)return void e.children.forEach((e=>r(e)));if("object"==typeof e.type){const t=e._component.subTree;e.type._isKeepAlive?e._component.keptAlive.__deActivate(t):r(t)}const t=e._el.parentNode;t&&t.removeChild(e._el)}function l(e,t,n){if(/^on/.test(e)){let o=(t._evi||(t._evi={}))[e];if(n)if(o)o.value=n;else{o=t._evi[e]=e=>{if(e.timeStamp<o.attachTime)return!1;Array.isArray(o.value)?o.value.forEach((e=>e)):"[object Object]"===Object.prototype.toString.call(o.value)?console.warn("事件值要为函数"):o.value(e)},o.value=n,o.attachTime=performance.now();const r=e.slice(2).toLowerCase();t.addEventListener(r,o)}else o&&t.removeEventListener(type,o)}"class"===e?t.className=n:!function(e,t){return("INPUT"!==t.tagName||"form"!==e)&&e in t}(e,t)?t.setAttribute(e,n):"boolean"==typeof t[e]&&""===n?t[e]=!0:t[e]=n}const c=Symbol(),s=Symbol(),i=Symbol();exports.createElement=function(e){return document.createElement(e)},exports.createRenderer=function(t){const{createElement:u,setTextContent:f,insert:a}=t;function p(t,y,m,_){t&&t.type!==y.type&&(r(t),t=null);const v=y.type;if("string"==typeof v)t?function(e,t){const n=t._el=e._el,o=e.props,r=t.props;for(const e in r)Object.hasOwnProperty.call(r,e)&&r[e]!==o[e]&&l(e,n,r[e]);h(e,t,n)}(t,y):function(e,t,n){const o=e._el=u(e.type),r=e.children;if(e.props)for(const t in e.props)l(t,o,e.props[t]);if("string"==typeof r)f(o,r);else if(Array.isArray(r))for(let e=0;e<r.length;e++)p(null,r[e],o);a(o,t,n)}(y,m,_);else if(v===s)if(t){const e=y._el=t._el;y.children!==t.children&&(e.nodeValue=y.children)}else{const e=y._el=document.createTextNode(y.children);a(e,m)}else if(v===i)t?h(t,y,m):y.children.forEach((e=>p(null,e,m)));else if(v===c);else if("object"==typeof v)if(t)!function(e,t,n,o){const r=t._component=e._component,{props:l}=r;if(function(e,t){const n=Object.keys(e),o=Object.keys(t);if(n!==o)return!0;for(let o=0;o<n;o++){if(e[o]!==t[o])return!0}return!1}(e.props,t.props)){const[e]=d(t.type.props,t.type);Object.keys(l).forEach((t=>{t in e?l[t]=e[t]:delete l[t]}))}}(t,y);else{const t=o();t._isCacheKeepAlive?t.keptAlive._activate(t.subTree,m,_):function(t,o,r){const l=t.type,{data:c,props:s,render:i,beforeCreate:u,created:f,beforeMounte:a,mounted:h,beforeUpdate:y,updated:m,setup:_}=l,[v,b]=d(s,t.props),g=t.children||{};u&&u.call();const A={state:e.reactive(c()),props:e.shallowReactive(v),subTree:null,isMounted:!1,mounted:[]};t._component=A;let x,E=i;if(_){const e={attr:b,emit:(e,...t)=>function(e,t,n){const o=`on${e[0].toUpperCase()}${e.slice(1)}`;o in n?n[o](t):console.warn(`当前事件未定义，请查看事件名称 ${o} 是否正确`)}(e,t,A.props),slots:g};n(A);const t=_(shallowReadOnly(A.props),e);n(null),"function"==typeof t?E=t:x=t}const T=new Proxy(A,{get(e,t){const{state:n,props:o}=e;return n&&t in n?n[t]:o&&t in o?o[t]:x&&t in x?x[t]:"$slots"===t?g:(console.warn("当前组件不存在该属性"),null)},set(e,t,n){const{state:o,props:r}=e;if(o&&t in o)o[t]=n;else if(r&&t in r)r[t]=n;else{if(!x||!(t in x))return console.warn("当前组件不存在该属性"),!1;x[t]=n}}});f&&f.call(T),e.effect((()=>{const e=E.call(T);A.isMounted?(y&&y.call(T),p(A.subTree,e,o,r),m&&m.call(T)):(a&&a.call(T),p(null,e,o,r),A.isMounted=!0,A.mounted&&A.mounted.forEach((e=>e(T)))),A.subTree=e}))}(y,m,_)}else"function"==typeof v&&(t||function(t,n,o){const r=t.type,l=t.type.options,c={props:e.shallowReactive(l),subTree:null,isMounted:!1};t._component=c,e.effect((()=>{const e=r(l);c.isMounted?p(c.subTree,e,n,o):(p(null,e,n,o),c.isMounted=!0),c.subTree=e}))}(y,m,_))}function d(e,t){const n={},o={};return Object.keys(t).forEach((r=>{r in e||"/^on/".text(r)?n[r]=t[r]:(console.warn("当前定义的属性在组件内没有定义，存放至 attr"),o[r]=t[r])})),[n,o]}function h(e,t,n){"string"==typeof t.children?(Array.isArray(e.children)&&e.children.forEach((e=>r(e))),f(n,t.children)):Array.isArray(t.children)?Array.isArray(e.children)?function(e,t,n){const o=e.children,l=t.children;let c=0,s=null,i=null;for(let e=0;e<l.length&&(s=o[e],i=l[e],i.key===s.key);e++)p(s,i,n),c++;const u=o.length,f=l.length,d=Math.max(u,f);let h=u-1,m=f-1;for(let e=d;e>=0&&(s=o[h],i=l[m],i.key===s.key);e--)p(s,i,n),h--,m--;if(h<c&&m>=c)for(let e=c;e<=m;e++)p(null,l[c],n,y(c,l));if(m<c&&h>=c)for(let e=c;e<=h;e++)r(o[e]);const _=new Array(m-c+1).fill(-1),v={};for(let e=c;e<=m;e++)v[l[e].key]=e;for(let e=c;e<=h;e++){s=o[e];const t=v[s.key];i=l[t],t>-1?(p(s,i,n),_[t-c]=e):r(s)}const b=function(e){const t=e.slice(),n=[0];let o,r,l,c,s;const i=e.length;for(o=0;o<i;o++){const i=e[o];if(0!==i){if(r=n[n.length-1],e[r]<i){t[o]=r,n.push(o);continue}for(l=0,c=n.length-1;l<c;)s=(l+c)/2|0,e[n[s]]<i?l=s+1:c=s;i<e[n[l]]&&(l>0&&(t[o]=n[l-1]),n[l]=o)}}l=n.length,c=n[l-1];for(;l-- >0;)n[l]=c,c=t[c];return n}(_),g=_.includes(-1);if(b.length<_.length||g){let e=b.length-1,t=_.length-1;for(;t>=0;t--)if(-1===_[t]){const e=t+c;p(null,l[e],n,y(e,l))}else if(t!==b[e]){let e=t+c;const o=l[e];a(o._el,n,y(e,l))}else e--}}(e,t,n):(f(el,""),t.children.forEach((e=>p(null,e,n)))):Array.isArray(e.children)?e.children.forEach((e=>r(e))):f(n,null)}function y(e,t){const n=t[e+1];return n?n._el:null}return{render:function(e,t){e?p(t._o_vnode,e,t):t._o_vnode&&r(t._o_vnode),t._o_vnode=e},patch:p}},exports.getInstance=o,exports.insert=function(e,t,n=null){t.insertBefore(e,n)},exports.onMounted=function(e){const t=o();t&&t.mounted.push(e)},exports.setInstance=n,exports.setTextContent=function(e,t){e.textContent=t},exports.unmount=r;
