import{shallowReactive as e,effect as n,reactive as t}from"@zxn2889/achieve-proxy";function o(e){if(e.type===Fragment)return void e.children.forEach((e=>o(e)));const n=e._el.parentNode;n&&n.removeChild(e._el)}function r(e,n,t){if(/^on/.test(e)){let o=(n._evi||(n._evi={}))[e];if(t)if(o)o.value=t;else{o=n._evi[e]=e=>{if(e.timeStamp<o.attachTime)return!1;Array.isArray(o.value)?o.value.forEach((e=>e)):"[object Object]"===Object.prototype.toString.call(o.value)?console.warn("事件值要为函数"):o.value(e)},o.value=t,o.attachTime=performance.now();const r=e.slice(2).toLowerCase();n.addEventListener(r,o)}else o&&n.removeEventListener(type,o)}"class"===e?n.className=t:!function(e,n){return("INPUT"!==n.tagName||"form"!==e)&&e in n}(e,n)?n.setAttribute(e,t):"boolean"==typeof n[e]&&""===t?n[e]=!0:n[e]=t}const l=Symbol(),c=Symbol(),s=Symbol();const i=function(i){const{createElement:u,setTextContent:f,insert:a}=i;function p(i,h,m,_){i&&i.type!==h.type&&(o(i),i=null);const b=h.type;if("string"==typeof b)i?function(e,n){const t=n._el=e._el,o=e.props,l=n.props;for(const e in l)Object.hasOwnProperty.call(l,e)&&l[e]!==o[e]&&r(e,t,l[e]);y(e,n,t)}(i,h):function(e,n,t){const o=e._el=u(e.type),l=e.children;if(e.props)for(const n in e.props)r(n,o,e.props[n]);if("string"==typeof l)f(o,l);else if(Array.isArray(l))for(let e=0;e<l.length;e++)p(null,l[e],o);a(o,n,t)}(h,m,_);else if(b===c)if(i){const e=h._el=i._el;h.children!==i.children&&(e.nodeValue=h.children)}else{const e=h._el=document.createTextNode(h.children);a(e,m)}else b===s?i?y(i,h,m):h.children.forEach((e=>p(null,e,m))):b===l||("object"==typeof b?i?function(e,n,t,o){const r=n._component=e._component,{props:l}=r;if(function(e,n){const t=Object.keys(e),o=Object.keys(n);if(t!==o)return!0;for(let o=0;o<t;o++){if(e[o]!==n[o])return!0}return!1}(e.props,n.props)){const[e]=d(n.type.props,n.type);Object.keys(l).forEach((n=>{n in e?l[n]=e[n]:delete l[n]}))}}(i,h):function(o,r,l){const c=o.type,{data:s,props:i,render:u,beforeCreate:f,created:a,beforeMounte:y,mounted:h,beforeUpdate:m,updated:_,setup:b}=c,[g,v]=d(i,o.props),E=o.children||{};f&&f.call();const A={state:t(s()),props:e(g),subTree:null,isMounted:!1,mounted:[]};o._component=A;let T,w=u;if(b){const e={attr:v,emit:(e,...n)=>function(e,n,t){const o=`on${e[0].toUpperCase()}${e.slice(1)}`;o in t?t[o](n):console.warn(`当前事件未定义，请查看事件名称 ${o} 是否正确`)}(e,n,A.props),slots:E},n=b(shallowReadOnly(A.props),e);"function"==typeof n?w=n:T=n}const k=new Proxy(A,{get(e,n){const{state:t,props:o}=e;return t&&n in t?t[n]:o&&n in o?o[n]:T&&n in T?T[n]:"$slots"===n?E:(console.warn("当前组件不存在该属性"),null)},set(e,n,t){const{state:o,props:r}=e;if(o&&n in o)o[n]=t;else if(r&&n in r)r[n]=t;else{if(!T||!(n in T))return console.warn("当前组件不存在该属性"),!1;T[n]=t}}});a&&a.call(k),n((()=>{const e=w.call(k);A.isMounted?(m&&m.call(k),p(A.subTree,e,r,l),_&&_.call(k)):(y&&y.call(k),p(null,e,r,l),A.isMounted=!0,A.mounted&&A.mounted.forEach((e=>e(k)))),A.subTree=e}))}(h,m,_):"function"==typeof b&&(i||function(t,o,r){const l=t.type,c=t.type.options,s={props:e(c),subTree:null,isMounted:!1};t._component=s,n((()=>{const e=l(c);s.isMounted?p(s.subTree,e,o,r):(p(null,e,o,r),s.isMounted=!0),s.subTree=e}))}(h,m,_)))}function d(e,n){const t={},o={};return Object.keys(n).forEach((r=>{r in e||"/^on/".text(r)?t[r]=n[r]:(console.warn("当前定义的属性在组件内没有定义，存放至 attr"),o[r]=n[r])})),[t,o]}function y(e,n,t){"string"==typeof n.children?(Array.isArray(e.children)&&e.children.forEach((e=>o(e))),f(t,n.children)):Array.isArray(n.children)?Array.isArray(e.children)?function(e,n,t){const r=e.children,l=n.children;let c=0,s=null,i=null;for(let e=0;e<l.length&&(s=r[e],i=l[e],i.key===s.key);e++)p(s,i,t),c++;const u=r.length,f=l.length,d=Math.max(u,f);let y=u-1,m=f-1;for(let e=d;e>=0&&(s=r[y],i=l[m],i.key===s.key);e--)p(s,i,t),y--,m--;if(y<c&&m>=c)for(let e=c;e<=m;e++)p(null,l[c],t,h(c,l));if(m<c&&y>=c)for(let e=c;e<=y;e++)o(r[e]);const _=new Array(m-c+1).fill(-1),b={};for(let e=c;e<=m;e++)b[l[e].key]=e;for(let e=c;e<=y;e++){s=r[e];const n=b[s.key];i=l[n],n>-1?(p(s,i,t),_[n-c]=e):o(s)}const g=function(e){const n=e.slice(),t=[0];let o,r,l,c,s;const i=e.length;for(o=0;o<i;o++){const i=e[o];if(0!==i){if(r=t[t.length-1],e[r]<i){n[o]=r,t.push(o);continue}for(l=0,c=t.length-1;l<c;)s=(l+c)/2|0,e[t[s]]<i?l=s+1:c=s;i<e[t[l]]&&(l>0&&(n[o]=t[l-1]),t[l]=o)}}l=t.length,c=t[l-1];for(;l-- >0;)t[l]=c,c=n[c];return t}(_),v=_.includes(-1);if(g.length<_.length||v){let e=g.length-1,n=_.length-1;for(;n>=0;n--)if(-1===_[n]){const e=n+c;p(null,l[e],t,h(e,l))}else if(n!==g[e]){let e=n+c;const o=l[e];a(o._el,t,h(e,l))}else e--}}(e,n,t):(f(el,""),n.children.forEach((e=>p(null,e,t)))):Array.isArray(e.children)?e.children.forEach((e=>o(e))):f(t,null)}function h(e,n){const t=n[e+1];return t?t._el:null}return{render:function(e,n){e?p(n._o_vnode,e,n):n._o_vnode&&o(n._o_vnode),n._o_vnode=e},patch:p}}({createElement:function(e){return document.createElement(e)},setTextContent:function(e,n){e.textContent=n},insert:function(e,n,t=null){n.insertBefore(e,t)}});function u(e){return{type:"div",children:`我是小黑，我今年 ${e.count} 岁了`}}u.options={count:1};const f={type:u};i.render(f,document.getElementById("app"));
