!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@zxn2889/achieve-proxy")):"function"==typeof define&&define.amd?define(["exports","@zxn2889/achieve-proxy"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).achieve={},e.achieveProxy)}(this,(function(e,t){"use strict";let n=null;function o(e){n=e}function r(){return n}function l(e){if(e.type===Fragment)return void e.children.forEach((e=>l(e)));if("object"==typeof e.type){const t=e._component.subTree;e.type._isKeepAlive?e._component.keptAlive.__deActivate(t):l(t)}const t=e._el.parentNode;t&&t.removeChild(e._el)}function c(e,t,n){if(/^on/.test(e)){let o=(t._evi||(t._evi={}))[e];if(n)if(o)o.value=n;else{o=t._evi[e]=e=>{if(e.timeStamp<o.attachTime)return!1;Array.isArray(o.value)?o.value.forEach((e=>e)):"[object Object]"===Object.prototype.toString.call(o.value)?console.warn("事件值要为函数"):o.value(e)},o.value=n,o.attachTime=performance.now();const r=e.slice(2).toLowerCase();t.addEventListener(r,o)}else o&&t.removeEventListener(type,o)}"class"===e?t.className=n:!function(e,t){return("INPUT"!==t.tagName||"form"!==e)&&e in t}(e,t)?t.setAttribute(e,n):"boolean"==typeof t[e]&&""===n?t[e]=!0:t[e]=n}const i=Symbol(),s=Symbol(),f=Symbol();e.createElement=function(e){return document.createElement(e)},e.createRenderer=function(e){const{createElement:n,setTextContent:u,insert:a}=e;function p(e,y,m,_){e&&e.type!==y.type&&(l(e),e=null);const v=y.type;if("string"==typeof v)e?function(e,t){const n=t._el=e._el,o=e.props,r=t.props;for(const e in r)Object.hasOwnProperty.call(r,e)&&r[e]!==o[e]&&c(e,n,r[e]);h(e,t,n)}(e,y):function(e,t,o){const r=e._el=n(e.type),l=e.children;if(e.props)for(const t in e.props)c(t,r,e.props[t]);if("string"==typeof l)u(r,l);else if(Array.isArray(l))for(let e=0;e<l.length;e++)p(null,l[e],r);a(r,t,o)}(y,m,_);else if(v===s)if(e){const t=y._el=e._el;y.children!==e.children&&(t.nodeValue=y.children)}else{const e=y._el=document.createTextNode(y.children);a(e,m)}else if(v===f)e?h(e,y,m):y.children.forEach((e=>p(null,e,m)));else if(v===i);else if("object"==typeof v)if(e)!function(e,t,n,o){const r=t._component=e._component,{props:l}=r;if(function(e,t){const n=Object.keys(e),o=Object.keys(t);if(n!==o)return!0;for(let o=0;o<n;o++){if(e[o]!==t[o])return!0}return!1}(e.props,t.props)){const[e]=d(t.type.props,t.type);Object.keys(l).forEach((t=>{t in e?l[t]=e[t]:delete l[t]}))}}(e,y);else{const e=r();e._isCacheKeepAlive?e.keptAlive._activate(e.subTree,m,_):function(e,n,r){const l=e.type,{data:c,props:i,render:s,beforeCreate:f,created:u,beforeMounte:a,mounted:h,beforeUpdate:y,updated:m,setup:_}=l,[v,b]=d(i,e.props),g=e.children||{};f&&f.call();const A={state:t.reactive(c()),props:t.shallowReactive(v),subTree:null,isMounted:!1,mounted:[]};e._component=A;let T,x=s;if(_){const e={attr:b,emit:(e,...t)=>function(e,t,n){const o=`on${e[0].toUpperCase()}${e.slice(1)}`;o in n?n[o](t):console.warn(`当前事件未定义，请查看事件名称 ${o} 是否正确`)}(e,t,A.props),slots:g};o(A);const t=_(shallowReadOnly(A.props),e);o(null),"function"==typeof t?x=t:T=t}const E=new Proxy(A,{get(e,t){const{state:n,props:o}=e;return n&&t in n?n[t]:o&&t in o?o[t]:T&&t in T?T[t]:"$slots"===t?g:(console.warn("当前组件不存在该属性"),null)},set(e,t,n){const{state:o,props:r}=e;if(o&&t in o)o[t]=n;else if(r&&t in r)r[t]=n;else{if(!T||!(t in T))return console.warn("当前组件不存在该属性"),!1;T[t]=n}}});u&&u.call(E),t.effect((()=>{const e=x.call(E);A.isMounted?(y&&y.call(E),p(A.subTree,e,n,r),m&&m.call(E)):(a&&a.call(E),p(null,e,n,r),A.isMounted=!0,A.mounted&&A.mounted.forEach((e=>e(E)))),A.subTree=e}))}(y,m,_)}else"function"==typeof v&&(e||function(e,n,o){const r=e.type,l=e.type.options,c={props:t.shallowReactive(l),subTree:null,isMounted:!1};e._component=c,t.effect((()=>{const e=r(l);c.isMounted?p(c.subTree,e,n,o):(p(null,e,n,o),c.isMounted=!0),c.subTree=e}))}(y,m,_))}function d(e,t){const n={},o={};return Object.keys(t).forEach((r=>{r in e||"/^on/".text(r)?n[r]=t[r]:(console.warn("当前定义的属性在组件内没有定义，存放至 attr"),o[r]=t[r])})),[n,o]}function h(e,t,n){"string"==typeof t.children?(Array.isArray(e.children)&&e.children.forEach((e=>l(e))),u(n,t.children)):Array.isArray(t.children)?Array.isArray(e.children)?function(e,t,n){const o=e.children,r=t.children;let c=0,i=null,s=null;for(let e=0;e<r.length&&(i=o[e],s=r[e],s.key===i.key);e++)p(i,s,n),c++;const f=o.length,u=r.length,d=Math.max(f,u);let h=f-1,m=u-1;for(let e=d;e>=0&&(i=o[h],s=r[m],s.key===i.key);e--)p(i,s,n),h--,m--;if(h<c&&m>=c)for(let e=c;e<=m;e++)p(null,r[c],n,y(c,r));if(m<c&&h>=c)for(let e=c;e<=h;e++)l(o[e]);const _=new Array(m-c+1).fill(-1),v={};for(let e=c;e<=m;e++)v[r[e].key]=e;for(let e=c;e<=h;e++){i=o[e];const t=v[i.key];s=r[t],t>-1?(p(i,s,n),_[t-c]=e):l(i)}const b=function(e){const t=e.slice(),n=[0];let o,r,l,c,i;const s=e.length;for(o=0;o<s;o++){const s=e[o];if(0!==s){if(r=n[n.length-1],e[r]<s){t[o]=r,n.push(o);continue}for(l=0,c=n.length-1;l<c;)i=(l+c)/2|0,e[n[i]]<s?l=i+1:c=i;s<e[n[l]]&&(l>0&&(t[o]=n[l-1]),n[l]=o)}}l=n.length,c=n[l-1];for(;l-- >0;)n[l]=c,c=t[c];return n}(_),g=_.includes(-1);if(b.length<_.length||g){let e=b.length-1,t=_.length-1;for(;t>=0;t--)if(-1===_[t]){const e=t+c;p(null,r[e],n,y(e,r))}else if(t!==b[e]){let e=t+c;const o=r[e];a(o._el,n,y(e,r))}else e--}}(e,t,n):(u(el,""),t.children.forEach((e=>p(null,e,n)))):Array.isArray(e.children)?e.children.forEach((e=>l(e))):u(n,null)}function y(e,t){const n=t[e+1];return n?n._el:null}return{render:function(e,t){e?p(t._o_vnode,e,t):t._o_vnode&&l(t._o_vnode),t._o_vnode=e},patch:p}},e.getInstance=r,e.insert=function(e,t,n=null){t.insertBefore(e,n)},e.onMounted=function(e){const t=r();t&&t.mounted.push(e)},e.setInstance=o,e.setTextContent=function(e,t){e.textContent=t},e.unmount=l}));
